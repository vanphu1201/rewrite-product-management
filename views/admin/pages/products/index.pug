extends ../../layouts/default
include ../../mixins/filter-status.pug
include ../../mixins/pagination.pug
include ../../mixins/multi-change.pug
include ../../mixins/alert.pug
block main
  if (role.permissions.includes("products_view"))
    +alertSuccess(5000)
    +alertDanger(5000)
    .card.mb-3
      .card-header Bộ lọc và Tìm kiếm
      .card-body
        .row 
          +filter-status(filterStatus)
          .col-6
            form#form-search
              .input-group
                  input(
                    type="text" 
                    placeholder="Nhập từ khóa" 
                    name="keyword" 
                    class="form-control" 
                    value=`${keyword ? keyword : ""}`
                    btn-form-search)
                  .input-group-append
                      button(class="btn btn-success" type="submit" input-form-search ) Tìm
    .card.mb-3
        .card-header Sắp xếp
        .card-body
            .row
                .col-4
                  div(sort)
                      select(
                          class="form-control"
                          name="sort"
                          sort-select
                      )
                          option(value="position-desc") Vị trí giảm dần
                          option(value="position-asc") Vị trí tăng dần
                          option(value="price-desc") Giá giảm dần
                          option(value="price-asc") Giá tăng dần
                          option(value="title-asc") Tiêu đề A - Z
                          option(value="title-desc") Tiêu đề Z - A
                      
                      button(
                          class="btn btn-danger mt-2"
                          sort-clear
                      ) Clear
    
    .card.mb-3
      .card-header Danh sách
      .card-body
        .row
          .col-8
            +multiChange()
          .col-4
            if (role.permissions.includes("products_create"))
              a(
              href=`/admin/products/create`
              class="btn btn-outline-success"
              ) + Thêm mới
        table.table.table-hover.table-sm
            thead
              tr
                th
                  input(type="checkbox" name="checkall")
                th STT
                th Hình ảnh
                th Tiêu đề
                th Giá
                th Vị trí
                th Trạng thái
                th Hành động
            tbody
              each item, index in products
                tr
                  td
                    input(
                        type="checkbox"
                        name="id"
                        value=item.id
                    )
                  td #{paginationObject.skip + index + 1}
                    td
                        img(
                            src=item.thumbnail
                            alt=item.title
                            width="100px"
                            height="auto"
                        )
                    td #{item.title}
                    td #{item.price}$
                    td
                      input(
                        type="number"
                        value=item.position
                        style="width: 60px"
                        min="1"
                        name="position"
                      )
                    
                    td
                      if (role.permissions.includes("products_edit"))
                        if (item.status == "active")
                          a(href="javascript:;" class="badge badge-success" data-status=item.status data-id=item.id) Hoạt động
                        else 
                          a(href="javascript:;" class="badge badge-danger" data-status=item.status data-id=item.id) Dừng hoạt động
                    td
                      a(
                          href=`/admin/products/detail/${item.id}`
                          class="btn btn-info btn-sm"
                          edit
                          data-id=item.id
                      ) Chi tiết
                      if (role.permissions.includes("products_edit"))
                        a(
                          href=`/admin/products/edit/${item.id}`
                          class="btn btn-warning btn-sm"
                          edit
                          data-id=item.id
                        ) Sửa
                      if (role.permissions.includes("products_delete"))
                        button(class="btn btn-danger btn-sm ml-1" delete data-id=item.id) Xóa
    //- pagination
    +pagination(paginationObject)
    //- end pagination


    //- form submit
    form(
          action=""
          method="POST"
          path="/admin/products/change-status"
          form-change-status
    )

    form(
          action=""
          method="POST"
          path="/admin/products/delete"
          form-delete-product
    )
  else 
    h1 Bạn không có quyền truy cập vào phần này!